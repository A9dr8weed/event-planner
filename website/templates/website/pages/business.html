{% extends 'website/pages/base.html' %}

{% load staticfiles %}

{% block css %}
    <link href="{% static 'website/css/calendar.min.css' %}" rel="stylesheet"/>
{% endblock css %}

{% block content %}
    <div class="main-image" id="filter" data-parallax="true" style="background-image:
            {% if user.is_client %}
                url({% static 'website/img/party-desk.jpg' %})
            {% else %}
                url({% static 'website/img/table.jpg' %})
            {% endif %}">
        <div class="container">
            <div class="content-center">
                <h3 class="display-1">{{ business.name }}</h3>
                <p class="info">{{ business.business_type }}</p>
                <div class="col-12">
                    <div class="form-inline">
                        <div class="btn-group col-12 col-md-6">
                            <button class="btn btn-primary btn-sm" data-calendar-nav="prev"><< Prev</button>
                            <button class="btn btn-primary btn-sm" data-calendar-nav="today">Today</button>
                            <button class="btn btn-primary btn-sm" data-calendar-nav="next">Next >></button>
                        </div>
                        <div class="btn-group col-12 col-md-6">
                            <button class="btn btn-primary btn-sm" data-calendar-view="year">Year</button>
                            <button class="btn btn-primary active btn-sm" data-calendar-view="month">Month</button>
                            <button class="btn btn-primary btn-sm" data-calendar-view="week">Week</button>
                            <button class="btn btn-primary btn-sm" data-calendar-view="day">Day</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="text-black" id="calendar"></div>
    <div class="button-container">
        <a href="{% url 'website:opinion' business.pk %}" class="btn btn-primary btn-round btn-lg">Opinions</a>
        <a href="{% url 'website:add_opinion' business.pk %}" class="btn btn-primary btn-round btn-lg">Add opinion</a>
    </div>
    <div class="description-container">
        <h3 class="title">About us</h3>
        <h5 class="description">{{ business.description }}</h5>
    </div>

{% endblock content %}

{% block js %}
    <script type="text/javascript" src="{% static 'website/js/vendor/underscore.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'website/js/vendor/calendar.min.js' %}"></script>
    <script type="text/javascript">
        var options = {
            events_source: "{% static 'website/js/vendor/tmpls/events.json.php' %}",
            view: 'month',
            tmpl_path: "{% static 'website/js/vendor/tmpls' %}/",
            tmpl_cache: false,
            day: 'now',
            onAfterEventsLoad: function (events) {
                if (!events) {
                    return;
                }
                var list = $('#eventlist');
                list.html('');

                $.each(events, function (key, val) {
                    $(document.createElement('li'))
                        .html('<a href="' + val.url + '">' + val.title + '</a>')
                        .appendTo(list);
                });
            },
            onAfterViewLoad: function (view) {
                $('.page-header h3').text(this.getTitle());
                $('.btn-group button').removeClass('active');
                $('button[data-calendar-view="' + view + '"]').addClass('active');
            },
            classes: {
                months: {
                    general: 'label'
                }
            }
        };

        var calendar = $('#calendar').calendar(options);

        $('.btn-group button[data-calendar-nav]').each(function () {
            var $this = $(this);
            $this.click(function () {
                calendar.navigate($this.data('calendar-nav'));
            });
        });

        $('.btn-group button[data-calendar-view]').each(function () {
            var $this = $(this);
            $this.click(function () {
                calendar.view($this.data('calendar-view'));
            });
        });

        $('#events-in-modal').change(function () {
            var val = $(this).is(':checked') ? $(this).val() : null;
            calendar.setOptions({modal: val});
        });

        $('#show_wbn').change(function () {
            var val = $(this).is(':checked') ? true : false;
            calendar.setOptions({display_week_numbers: val});
            calendar.view();
        });
        $('#show_wb').change(function () {
            var val = $(this).is(':checked') ? true : false;
            calendar.setOptions({weekbox: val});
            calendar.view();
        });
    </script>
{% endblock js %}